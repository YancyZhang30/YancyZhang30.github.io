ç”±äºå·¥ä½œä¸­å¾ˆå°‘ç”¨åˆ°Reactï¼Œæ‰€ä»¥è®°å½•çš„å¯èƒ½è¯¦ç»†ä¸€ç‚¹ï¼Œä½†æ˜¯æˆ‘çœ‹ä¹¦é‡Œé¢å¾ˆå¤šæ˜¯æŒ‰ç…§
ç±»ç»„ä»¶æ¥ä¸¾ä¾‹çš„ï¼Œ16.8ä¹‹åï¼Œåº”è¯¥å¾ˆå°‘ä½¿ç”¨ç±»ç»„ä»¶äº†å§ï¼Œæ‰€ä»¥ä¸»è¦æŠŠå‡ ä¸ªhookså†å›
é¡¾ä¸€éã€‚

## ä¸€ã€Hooks

ä¸ºä»€ä¹ˆä½¿ç”¨Hooksï¼ˆå‡½æ•°å¼ç»„ä»¶ï¼‰ä»£æ›¿ç±»ç»„ä»¶ï¼Ÿ

(1)é’ˆå¯¹ä¼˜åŒ–ç±»ç»„ä»¶çš„ä¸‰å¤§é—®é¢˜ï¼šçŠ¶æ€é€»è¾‘éš¾å¤ç”¨ã€è¶‹å‘å¤æ‚éš¾ä»¥ç»´æŠ¤ã€thisæŒ‡å‘é—®é¢˜ã€‚

(2)åœ¨æ— é¡»ä¿®æ”¹ç»„ä»¶ç»“æ„çš„æƒ…å†µä¸‹å¤ç”¨çŠ¶æ€é€»è¾‘ï¼ˆè‡ªå®šä¹‰Hookï¼‰ã€‚

(3)å°†ç»„ä»¶ä¸­ç›¸äº’å…³è”çš„éƒ¨åˆ†æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ï¼ˆä¾‹å¦‚è®¾ç½®è®¢é˜…æˆ–è¯·æ±‚æ•°æ®ï¼‰ã€‚

(4)å‰¯ä½œç”¨çš„å…³æ³¨ç‚¹åˆ†ç¦»ï¼šå‰¯ä½œç”¨æŒ‡é‚£äº›æ²¡æœ‰å‘ç”Ÿåœ¨æ•°æ®å‘è§†å›¾è½¬æ¢è¿‡ç¨‹ä¸­çš„é€»è¾‘ï¼Œå¦‚Ajaxè¯·æ±‚ã€è®¿é—®åŸç”ŸDOMå…ƒç´ ã€æœ¬åœ°æŒä¹…åŒ–ç¼“å­˜ã€ç»‘å®šï¼è§£ç»‘äº‹ä»¶ã€æ·»åŠ è®¢é˜…ã€è®¾ç½®å®šæ—¶å™¨ã€è®°å½•æ—¥å¿—ç­‰ã€‚è¿™äº›`å‰¯ä½œç”¨`éƒ½å†™åœ¨ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸå‡½æ•°ä¸­ã€‚

Reactä¼šä¿æŒå¯¹å½“å‰æ¸²æŸ“ç»„ä»¶çš„è¿½è¸ªï¼Œæ¯ä¸ªç»„ä»¶å†…éƒ¨éƒ½æœ‰ä¸€ä¸ª`è®°å¿†å•å…ƒæ ¼`ï¼Œç”¨äºå­˜å‚¨JSå¯¹è±¡æ•°æ®ã€‚å½“è°ƒç”¨Hookæ—¶å°±å¯è¯»å–å½“å‰Hookæ‰€åœ¨ç»„ä»¶çš„è®°å¿†å•å…ƒæ ¼é‡Œé¢çš„æ•°æ®ã€‚

### useState

useState()ç”¨äºä¸ºå‡½æ•°å¼ç»„ä»¶å¼•å…¥çŠ¶æ€(state)ã€‚å› ä¸ºçº¯å‡½æ•°ä¸èƒ½æœ‰çŠ¶æ€ï¼Œæ‰€ä»¥æŠŠçŠ¶æ€æ”¾åœ¨é’©å­é‡Œé¢ã€‚

### åˆå§‹åŒ–state

[![useState](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P553_26593.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P553_26593.jpg)

ä¸Šé¢çš„ä»£ç ä¼šè¿”å›ä¸€ä¸ªnumå’Œnumçš„æ›´æ–°å‡½æ•°ï¼Œnumå’ŒsetNumåç§°æ˜¯è‡ªå·±å®šä¹‰çš„ã€‚åœ¨åˆå§‹æ¸²æŸ“æœŸé—´ï¼Œè¿”å›çš„çŠ¶æ€(num)ä¸ä¼ å…¥çš„ç¬¬1ä¸ªå‚æ•°(initialState)çš„å€¼ç›¸åŒã€‚setNum()å‡½æ•°ç”¨äºæ›´æ–°numï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªæ–°çš„numå€¼å¹¶å°†ç»„ä»¶çš„ä¸€æ¬¡é‡æ–°æ¸²æŸ“åŠ å…¥é˜Ÿåˆ—ã€‚

### æƒ°æ€§åˆå§‹åŒ–state

initialStateå‚æ•°åªä¼šåœ¨ç»„ä»¶çš„åˆå§‹æ¸²æŸ“ä¸­èµ·ä½œç”¨ï¼Œåç»­æ¸²æŸ“æ—¶ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœåˆå§‹numéœ€è¦é€šè¿‡å¤æ‚è®¡ç®—è·å¾—ï¼Œåˆ™å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨å‡½æ•°ä¸­è®¡ç®—å¹¶è¿”å›åˆå§‹çš„numï¼Œæ­¤å‡½æ•°åªåœ¨åˆå§‹æ¸²æŸ“æ—¶è¢«è°ƒç”¨ã€‚

å®ƒåº”è¯¥æ˜¯çº¯å‡½æ•°ï¼Œä¸åº”è¯¥æ¥å—ä»»ä½•å‚æ•°ï¼Œå¹¶ä¸”åº”è¯¥è¿”å›ä¸€ä¸ªä»»ä½•ç±»å‹çš„å€¼ã€‚å½“åˆå§‹åŒ–ç»„ä»¶æ—¶ï¼ŒReact å°†è°ƒç”¨ä½ çš„åˆå§‹åŒ–å‡½æ•°ï¼Œå¹¶å°†å…¶è¿”å›å€¼å­˜å‚¨ä¸ºåˆå§‹çŠ¶æ€ã€‚

[![æƒ°æ€§state](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P554_26604.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P554_26604.jpg)

useStateç”¨æ³•ï¼š
[![state](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P554_26616.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P554_26616.jpg)

### æ›´æ–°state

å¦‚æœæ–°çš„stateéœ€è¦é€šè¿‡å…ˆå‰çš„stateè®¡ç®—å¾—å‡ºï¼Œåˆ™å¯ä»¥å°†`å‡½æ•°`ä¼ é€’ç»™setState()ã€‚è¯¥`å‡½æ•°å°†æ¥æ”¶å…ˆå‰çš„state`ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ›´æ–°åçš„å€¼ã€‚

[![æ›´æ–°state](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P555_26786.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P555_26786.jpg)

å› ä¸ºè¢«æ›´æ–°çš„stateéœ€è¦åŸºäºä¹‹å‰çš„stateï¼Œä½†æ˜¯â€œé‡ç½®â€æŒ‰é’®åˆ™é‡‡ç”¨æ™®é€šå½¢å¼ï¼Œå› ä¸ºå®ƒæ€»æ˜¯æŠŠcountè®¾ç½®å›åˆå§‹å€¼ã€‚

### useEffect

useEffect()ç”¨æ¥å¼•å…¥å…·æœ‰å‰¯ä½œç”¨çš„æ“ä½œï¼Œæœ€å¸¸è§çš„å°±æ˜¯å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚ä»¥å‰æ”¾åœ¨componentDidMounté‡Œé¢çš„ä»£ç ï¼Œç°åœ¨å¯ä»¥æ”¾åœ¨useEffect()é‡Œã€‚

[![useEffect](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P556_26860.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P556_26860.jpg)

useEffect()æ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬1ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¼‚æ­¥æ“ä½œçš„ä»£ç æ”¾åœ¨é‡Œé¢ã€‚ç¬¬2ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºç»™å‡ºeffectçš„ä¾èµ–é¡¹ï¼Œåªè¦è¿™ä¸ªæ•°ç»„å‘ç”Ÿå˜åŒ–ï¼ŒuseEffect()å°±ä¼šæ‰§è¡Œã€‚ç¬¬2ä¸ªå‚æ•°å¯ä»¥çœç•¥ï¼Œè¿™æ—¶æ¯æ¬¡ç»„ä»¶æ¸²æŸ“æ—¶ï¼Œéƒ½ä¼šæ‰§è¡ŒuseEffect()ã€‚

[![useEffect](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P556_26872.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P556_26872.jpg)

ç»„ä»¶å¸è½½æ—¶éœ€è¦æ¸…é™¤effectåˆ›å»ºçš„è¯¸å¦‚è®¢é˜…æˆ–è®¡æ—¶å™¨IDç­‰èµ„æºã€‚è¦å®ç°è¿™ä¸€ç‚¹ï¼ŒuseEffect()å‡½æ•°éœ€è¿”å›ä¸€ä¸ªæ¸…é™¤å‡½æ•°ã€‚

#### å…³æ³¨ç‚¹åˆ†ç¦»

ä½¿ç”¨Hookå…¶ä¸­çš„ä¸€ä¸ªç›®çš„å°±æ˜¯è¦è§£å†³classä¸­ç”Ÿå‘½å‘¨æœŸå‡½æ•°ç»å¸¸åŒ…å«ä¸ç›¸å…³çš„é€»è¾‘ï¼Œä½†åˆæŠŠç›¸å…³é€»è¾‘åˆ†ç¦»åˆ°äº†å‡ ä¸ªä¸åŒæ–¹æ³•ä¸­çš„é—®é¢˜ã€‚Hookå…è®¸æŒ‰ç…§ä»£ç çš„ç”¨é€”åˆ†ç¦»å®ƒä»¬ï¼Œè€Œä¸æ˜¯åƒç”Ÿå‘½å‘¨æœŸå‡½æ•°é‚£æ ·ã€‚Reactå°†æŒ‰ç…§effectå£°æ˜çš„é¡ºåºä¾æ¬¡è°ƒç”¨ç»„ä»¶ä¸­çš„æ¯ä¸ªeffectã€‚

[![useEffect](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P559_27128.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P559_27128.jpg)

### useLayoutEffect

useLayoutEffect()å‡½æ•°ç­¾åä¸useEffect()ç±»ä¼¼ï¼Œä½†å®ƒä¼šåœ¨æ‰€æœ‰çš„DOMå˜æ›´ä¹‹ååŒæ­¥è°ƒç”¨effectã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å–DOMå¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼ŒuseLayoutEffect()å†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°ã€‚

[![useLayoutEffect](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P560_27153.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P560_27153.jpg)

è¿è¡Œä¸Šé¢çš„ç»„ä»¶ï¼Œå•å‡»divæŒ‰é’®ï¼Œé¡µé¢ä¼šæ›´æ–°ä¸€ä¸²éšæœºæ•°ï¼Œå½“è¿ç»­å•å‡»æ­¤æŒ‰é’®æ—¶ï¼Œä¼šå‘ç°è¿™ä¸²æ•°å­—åœ¨å‘ç”ŸæŠ–åŠ¨ã€‚é€ æˆæŠ–åŠ¨åŸå› åœ¨äºï¼Œæ¯æ¬¡å•å‡»divæŒ‰é’®æ—¶ï¼Œcountä¼šæ›´æ–°ä¸º0(`setCount(0)`)ï¼Œä¹‹å`useEffect()`å†…åˆæŠŠcountæ”¹ä¸ºä¸€ä¸²éšæœºæ•°ï¼Œæ‰€ä»¥é¡µé¢ä¼š`å…ˆæ¸²æŸ“æˆ0`ï¼Œç„¶å`æ¸²æŸ“æˆéšæœºæ•°`ï¼Œç”±äºæ›´æ–°å¾ˆå¿«ï¼Œæ‰€ä»¥å‡ºç°äº†`é—ªçƒ`ã€‚

æ¥ä¸‹æ¥å°†useEffect()æ”¹ä¸ºuseLayoutEffect()åé—ªçƒæ¶ˆå¤±äº†ã€‚ç›¸æ¯”ä½¿ç”¨useEffect()ï¼Œå½“å•å‡»divæŒ‰é’®æ—¶ï¼Œcountæ›´æ–°ä¸º0ï¼Œæ­¤æ—¶é¡µé¢å¹¶ä¸ä¼šæ¸²æŸ“ï¼Œè€Œæ˜¯ç­‰å¾…`useLayoutEffect()å†…éƒ¨çŠ¶æ€ä¿®æ”¹åæ‰ä¼šå»æ›´æ–°é¡µé¢`ï¼Œæ‰€ä»¥é¡µé¢ä¸ä¼šé—ªçƒã€‚

[![æµè§ˆå™¨æ¸²æŸ“](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P560_27177.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P560_27177.jpg)

useLayoutEffect()ï¼šä¼šåœ¨æµè§ˆå™¨layoutä¹‹åï¼Œpainting(ç»˜åˆ¶)ä¹‹å‰æ‰§è¡Œã€‚å¦‚æœéœ€è¦æ”¹å˜DOMæˆ–è€…DOMéœ€è¦è·å–æµ‹é‡æ•°å€¼ï¼Œé™¤éè¦ä¿®æ”¹DOMå¹¶ä¸”ä¸è®©ç”¨æˆ·çœ‹åˆ°ä¿®æ”¹DOMçš„è¿‡ç¨‹ï¼Œæ‰è€ƒè™‘ç”¨å®ƒæ¥è¯»å–DOMå¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ï¼Œå¦åˆ™åº”å½“ä½¿ç”¨useEffect()ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼ŒuseLayoutEffect()å†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°ã€‚å°½å¯èƒ½ä½¿ç”¨æ ‡å‡†çš„useEffect()ä»¥é¿å…é˜»å¡è§†å›¾æ›´æ–°ã€‚

useEffect()ï¼šuseEffect()åœ¨å…¨éƒ¨æ¸²æŸ“å®Œæ¯•åæ‰ä¼šæ‰§è¡Œã€‚å¦‚æœæ ¹æœ¬ä¸éœ€è¦ä¸DOMäº¤äº’æˆ–è€…DOMæ›´æ”¹æ˜¯ä¸å¯è§‚å¯Ÿçš„ï¼Œé‚£å°±ç”¨useEffect()ã€‚

### useRef

(1)useRef()è¿”å›ä¸€ä¸ªå¯å˜çš„refå¯¹è±¡ï¼Œå¹¶ä¸”åªæœ‰currentå±æ€§ï¼Œåˆå§‹å€¼ä¸ºä¼ å…¥çš„å‚æ•°(initialValue)ã€‚

(2)è¿”å›çš„refå¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ä¿æŒä¸å˜ã€‚

(3)å½“æ›´æ–°currentå€¼æ—¶å¹¶ä¸ä¼šæ¸²æŸ“ï¼Œè€ŒuseState()æ–°å€¼æ—¶ä¼šè§¦å‘é¡µé¢æ¸²æŸ“ã€‚

(4)æ›´æ–°useRef()æ˜¯Side Effectï¼ˆå‰¯ä½œç”¨ï¼‰ï¼Œæ‰€ä»¥ä¸€èˆ¬å†™åœ¨useEffect()æˆ–Event Handleré‡Œã€‚

(5)useRef()ç±»ä¼¼äºç±»ç»„ä»¶çš„thisã€‚

[![useRef](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P561_27189.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P561_27189.jpg)

#### è·å–å­ç»„ä»¶å±æ€§æˆ–æ–¹æ³•

ç»¼åˆä½¿ç”¨useRef()ã€forwardRef()ã€useImperativeHandle()è·å–å­ç»„ä»¶æ•°æ®ã€‚

[![è·å–å­ç»„ä»¶å±æ€§æˆ–æ–¹æ³•](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T562_27293.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T562_27293.jpg)

å­ç»„ä»¶ï¼š

[![å­ç»„ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P562_27273.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P562_27273.jpg)

çˆ¶ç»„ä»¶ï¼š

[![çˆ¶ç»„ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P563_27319.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P563_27319.jpg)

#### ä½¿ç”¨useRef()è·å–ä¸Šä¸€æ¬¡çš„å€¼

[![useRef](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P564_27375.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P564_27375.jpg)

useRef()å‡½æ•°åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æ€»æ˜¯è¿”å›ä¸Šä¸€æ¬¡çš„å€¼ï¼Œå› ä¸ºref.currentå˜åŒ–ä¸ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥éœ€è¦ç­‰åˆ°ä¸‹æ¬¡æ¸²æŸ“æ—¶æ‰èƒ½æ˜¾ç¤ºåˆ°é¡µé¢ä¸Šã€‚

#### ä½¿ç”¨useRefä¿å­˜ä¸éœ€è¦å˜åŒ–çš„å€¼

å› ä¸ºuseRef()çš„è¿”å›å€¼åœ¨ç»„ä»¶çš„æ¯æ¬¡è°ƒç”¨render()ä¹‹åéƒ½æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥å®ƒå¯ä»¥ç”¨æ¥ä¿å­˜ä¸€äº›åœ¨ç»„ä»¶æ•´ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½ä¸éœ€è¦å˜åŒ–çš„å€¼ã€‚æœ€å¸¸è§çš„å°±æ˜¯å®šæ—¶å™¨çš„æ¸…é™¤åœºæ™¯ã€‚

å…¨å±€å˜é‡è®¾ç½®å®šæ—¶å™¨çš„ä¸è¶³:

[![å…¨å±€å˜é‡å®šæ—¶å™¨](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P564_27387.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P564_27387.jpg)

ä¸Šé¢çš„å†™æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœè¿™ä¸ªAppç»„ä»¶é‡Œæœ‰stateå˜åŒ–æˆ–è€…å®ƒçš„çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ç­‰åŸå› å¯¼è‡´è¿™ä¸ªAppç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ä¼šå‘ç°ï¼Œå•å‡»â€œåœæ­¢â€æŒ‰é’®ï¼Œå®šæ—¶å™¨ä¾ç„¶ä¼šä¸æ–­åœ°åœ¨æ§åˆ¶å°è¾“å‡ºï¼Œè¿™æ ·å®šæ—¶å™¨æ¸…é™¤äº‹ä»¶å°±æ— æ•ˆäº†ã€‚å› ä¸ºç»„ä»¶é‡æ–°æ¸²æŸ“ä¹‹åï¼Œè¿™é‡Œçš„timer()åŠclearTimer()æ–¹æ³•éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œæ‰€ä»¥timerå·²ç»ä¸æ˜¯å®šæ—¶å™¨çš„å˜é‡äº†

ä½¿ç”¨useRefä¼˜åŒ–ï¼š

[![useRef](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P565_27437.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P565_27437.jpg)

### useCallbackã€useMemoä¸React.memo

Reactä¸­å½“ç»„ä»¶çš„propsæˆ–stateå˜åŒ–æ—¶ï¼Œä¼šé‡æ–°æ¸²æŸ“è§†å›¾ï¼Œåœ¨å®é™…å¼€å‘ä¸­ä¼šé‡åˆ°ä¸å¿…è¦çš„æ¸²æŸ“åœºæ™¯ã€‚

#### ä¸å¿…è¦æ¸²æŸ“å­ç»„ä»¶

[![ä¸å¿…è¦æ¸²æŸ“](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P565_27485.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P565_27485.jpg)

å­ç»„ä»¶ä¸­æœ‰æ¡consoleè¯­å¥ï¼Œæ¯å½“å­ç»„ä»¶è¢«æ¸²æŸ“æ—¶ï¼Œéƒ½ä¼šåœ¨æ§åˆ¶å°çœ‹åˆ°ä¸€æ¡è¾“å‡ºä¿¡æ¯ã€‚å½“å•å‡»çˆ¶ç»„ä»¶ä¸­æŒ‰é’®æ—¶ä¼šä¿®æ”¹countå˜é‡çš„å€¼ï¼Œè¿›è€Œå¯¼è‡´çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œæ­¤æ—¶å­ç»„ä»¶å´æ²¡æœ‰ä»»ä½•å˜åŒ–(propsã€state)ï¼Œä½†åœ¨æ§åˆ¶å°ä¸­ä»ç„¶å¯çœ‹åˆ°å­ç»„ä»¶è¢«æ¸²æŸ“çš„è¾“å‡ºä¿¡æ¯ã€‚

æˆ‘ä»¬æœŸå¾…çš„æ˜¯ï¼šå½“å­ç»„ä»¶çš„propså’Œstateæ²¡æœ‰å˜åŒ–æ—¶ï¼Œå³ä¾¿çˆ¶ç»„ä»¶æ¸²æŸ“ï¼Œä¹Ÿä¸è¦æ¸²æŸ“å­ç»„ä»¶ã€‚

#### React.memo()

ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œéœ€è¦ä¿®æ”¹å­ç»„ä»¶ï¼Œç”¨React.memo()åŒ…è£¹ä¸€å±‚ã€‚è¿™ç§å†™æ³•æ˜¯Reactçš„é«˜é˜¶ç»„ä»¶å†™æ³•ï¼Œå°†ç»„ä»¶ä½œä¸ºå‡½æ•°(memo)çš„å‚æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼(ChildComp)æ˜¯ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚

[![React.memo()](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P566_27567.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P566_27567.jpg)

æ­¤æ—¶å†æ¬¡å•å‡»æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ²¡æœ‰è¾“å‡ºå­ç»„ä»¶è¢«æ¸²æŸ“çš„ä¿¡æ¯äº†ã€‚

#### useCallBack()

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œçˆ¶ç»„ä»¶åªæ˜¯ç®€å•åœ°è°ƒç”¨äº†å­ç»„ä»¶ï¼Œå¹¶æœªç»™å­ç»„ä»¶ä¼ é€’ä»»ä½•å±æ€§ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸ªçˆ¶ç»„ä»¶ç»™å­ç»„ä»¶ä¼ é€’å±æ€§çš„ä¾‹å­ï¼Œå­ç»„ä»¶ä»ç„¶ç”¨React.memo()åŒ…è£¹ä¸€å±‚ã€‚

[![useCallback()](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P567_27595.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P567_27595.jpg)

çˆ¶ç»„ä»¶åœ¨è°ƒç”¨å­ç»„ä»¶æ—¶ä¼ é€’äº†nameå±æ€§å’ŒonClickå±æ€§ï¼Œæ­¤æ—¶å•å‡»çˆ¶ç»„ä»¶çš„æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°æ§åˆ¶å°ä¸­è¾“å‡ºäº†å­ç»„ä»¶è¢«æ¸²æŸ“çš„ä¿¡æ¯ã€‚

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå­ç»„ä»¶é€šè¿‡React.memo()åŒ…è£¹äº†ï¼Œä½†æ˜¯å­ç»„ä»¶è¿˜æ˜¯é‡æ–°æ¸²æŸ“äº†ã€‚

åˆ†æä¸‹åŸå› ï¼š

(1)å•å‡»çˆ¶ç»„ä»¶æŒ‰é’®ï¼Œæ”¹å˜äº†çˆ¶ç»„ä»¶ä¸­countå˜é‡å€¼ï¼ˆçˆ¶ç»„ä»¶çš„stateå€¼ï¼‰ï¼Œè¿›è€Œå¯¼è‡´çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

(2)çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¼šé‡æ–°åˆ›å»ºchangeName()å‡½æ•°ï¼Œå³ä¼ ç»™å­ç»„ä»¶çš„onClickå±æ€§å‘ç”Ÿäº†å˜åŒ–ï¼Œä»è€Œå¯¼è‡´å­ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚åªæ˜¯å•å‡»äº†çˆ¶ç»„ä»¶çš„æŒ‰é’®ï¼Œå¹¶æœªå¯¹å­ç»„ä»¶åšä»»ä½•æ“ä½œï¼Œå¹¶ä¸”ä¸å¸Œæœ›å­ç»„ä»¶çš„propsæœ‰å˜åŒ–ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨useCallback()é’©å­å®Œå–„ä»£ç ã€‚é¦–å…ˆä¿®æ”¹çˆ¶ç»„ä»¶çš„changeName()æ–¹æ³•ï¼Œç”¨useCallback()é’©å­å‡½æ•°åŒ…è£¹ä¸€å±‚ã€‚

[![useCallback()](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P568_27687.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P568_27687.jpg)

ä¸Šé¢çš„ä»£ç ä¿®æ”¹åï¼Œæ­¤æ—¶å•å‡»çˆ¶ç»„ä»¶æŒ‰é’®ï¼Œæ§åˆ¶å°ä¸ä¼šè¾“å‡ºå­ç»„ä»¶è¢«æ¸²æŸ“çš„ä¿¡æ¯äº†ã€‚

useCallback()èµ·åˆ°äº†`ç¼“å­˜çš„ä½œç”¨`ï¼Œå³ä¾¿çˆ¶ç»„ä»¶æ¸²æŸ“äº†ï¼ŒuseCallback()åŒ…è£¹çš„å‡½æ•°ä¹Ÿä¸ä¼šé‡æ–°ç”Ÿæˆï¼Œåªä¼šè¿”å›ä¸Šä¸€æ¬¡çš„å‡½æ•°å¼•ç”¨ã€‚

useCallbackçš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ˜¯ä¸€ä¸ªdependenciesæ•°ç»„ï¼Œå‚è€ƒuseEffcetçš„ç¬¬äºŒä¸ªå‚æ•°ã€‚

#### useMemo

å‰é¢çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æ—¶ä¼ é€’çš„nameå±æ€§æ˜¯ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœæ¢æˆ`ä¼ é€’å¯¹è±¡`ä¼šæ€æ ·ï¼Ÿ

[![ä¼ é€’å±æ€§ä¸ºå¯¹è±¡](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P569_27741.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P569_27741.jpg)

çˆ¶ç»„ä»¶åœ¨è°ƒç”¨å­ç»„ä»¶æ—¶ä¼ é€’infoå±æ€§ï¼Œinfoçš„å€¼æ˜¯ä¸ªå¯¹è±¡å­—é¢é‡ï¼Œå•å‡»çˆ¶ç»„ä»¶æŒ‰é’®æ—¶ï¼Œå‘ç°æ§åˆ¶å°è¾“å‡ºå­ç»„ä»¶è¢«æ¸²æŸ“çš„ä¿¡æ¯ã€‚

åˆ†æåŸå› è·Ÿè°ƒç”¨å‡½æ•°æ˜¯ä¸€æ ·çš„ï¼šå½“å•å‡»çˆ¶ç»„ä»¶æŒ‰é’®æ—¶ï¼Œè§¦å‘çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼›çˆ¶ç»„ä»¶æ¸²æŸ“ï¼Œä»£ç const info={name,age}ä¼š`é‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°å¯¹è±¡`ï¼Œå¯¼è‡´ä¼ é€’ç»™å­ç»„ä»¶çš„`infoå±æ€§å€¼`å˜åŒ–ï¼Œè¿›è€Œå¯¼è‡´å­ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨useMemo()å¯¹å¯¹è±¡å±æ€§åŒ…è£¹ä¸€å±‚ã€‚

[![useMemo](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P569_27784.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P569_27784.jpg)

useMemo()æœ‰ä¸¤ä¸ªå‚æ•°ï¼š

(1)ç¬¬1ä¸ªå‚æ•°æ˜¯ä¸ªå‡½æ•°ï¼Œè¿”å›çš„å¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªå¼•ç”¨ï¼Œä¸ä¼šåˆ›å»ºæ–°å¯¹è±¡ã€‚

(2)ç¬¬2ä¸ªå‚æ•°æ˜¯ä¸ªæ•°ç»„ï¼Œåªæœ‰`æ•°ç»„ä¸­çš„å˜é‡æ”¹å˜`æ—¶ï¼Œç¬¬1ä¸ªå‚æ•°çš„å‡½æ•°æ‰ä¼š`è¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡`ã€‚

å½“å†æ¬¡å•å‡»çˆ¶ç»„ä»¶æŒ‰é’®æ—¶ï¼Œæ§åˆ¶å°ä¸­ä¸å†è¾“å‡ºå­ç»„ä»¶è¢«æ¸²æŸ“çš„ä¿¡æ¯äº†ã€‚

### useContext

åœ¨Hookè¯ç”Ÿä¹‹å‰ï¼ŒReactå·²ç»æœ‰äº†åœ¨ç»„ä»¶æ ‘ä¸­å…±äº«æ•°æ®çš„è§£å†³æ–¹æ¡ˆï¼šContextã€‚

åœ¨ç±»ç»„ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡Class.contextTypeå±æ€§è·å–æœ€è¿‘çš„Context Providerï¼Œé‚£ä¹ˆåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ï¼Œè¯¥æ€ä¹ˆè·å–å‘¢ï¼Ÿ

ç­”æ¡ˆå°±æ˜¯ä½¿ç”¨`useContext()`é’©å­

[![useContext](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P571_27893.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P571_27893.jpg)

useContext()çš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ã€‚

(1)å°è£…å…¬å…±ä¸Šä¸‹æ–‡å¯¹è±¡æ–‡ä»¶ã€‚

[![useContextç”¨æ³•](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P571_27902.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P571_27902.jpg)

(2)åœ¨çˆ¶ç»„ä»¶ä¸­é€šè¿‡myContext`æä¾›å™¨Providerä¸ºå­ç»„ä»¶æä¾›valueæ•°æ®`ã€‚

[![myContext](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P571_27910.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P571_27910.jpg)

(3)åœ¨å­ç»„ä»¶ä¸­`å¯¼å…¥myContextå¯¹è±¡`ï¼Œä½¿ç”¨`useContext()`è·å–å…±äº«æ•°æ®ã€‚

[![å­ç»„ä»¶å…±äº«context](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P572_27998.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P572_27998.jpg)

### useReducer()

useReducer()å‡½æ•°å¯æä¾›ç±»ä¼¼Reduxçš„åŠŸèƒ½ï¼Œå¯ä»¥ç†è§£ä¸ºè½»é‡çº§çš„Reduxã€‚useReducer()æ¥æ”¶ä¸€ä¸ªreducer()å‡½æ•°ä½œä¸ºå‚æ•°å’Œä¸€ä¸ªåˆå§‹åŒ–çš„çŠ¶æ€å€¼ã€‚

[![useReducer](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P572_28046.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P572_28046.jpg)

å»reactå®˜ç½‘çœ‹äº†ä¸€ä¸‹ï¼Œè¿™ä¸ªuseReducerå…¶å®å¯ä»¥æœ‰ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚

```tsx
useReducer(reducer, initialArg, init?)
```

reducerï¼šç”¨äºæ›´æ–° state çš„çº¯å‡½æ•°ã€‚å‚æ•°ä¸º state å’Œ actionï¼Œè¿”å›å€¼æ˜¯æ›´æ–°åçš„ stateã€‚state ä¸ action å¯ä»¥æ˜¯ä»»æ„åˆæ³•å€¼ã€‚

initialArgï¼šç”¨äºåˆå§‹åŒ– state çš„ä»»æ„å€¼ã€‚åˆå§‹å€¼çš„è®¡ç®—é€»è¾‘å–å†³äºæ¥ä¸‹æ¥çš„ init å‚æ•°ã€‚

å¯é€‰å‚æ•° initï¼šç”¨äºè®¡ç®—åˆå§‹å€¼çš„å‡½æ•°ã€‚å¦‚æœå­˜åœ¨ï¼Œä½¿ç”¨ init(initialArg) çš„æ‰§è¡Œç»“æœä½œä¸ºåˆå§‹å€¼ï¼Œå¦åˆ™ä½¿ç”¨ initialArgã€‚

useReducer()å‡½æ•°è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸€é¡¹ä¸ºçŠ¶æ€å˜é‡ï¼Œdispatchæ˜¯å‘é€äº‹ä»¶çš„æ–¹æ³•ï¼Œç”¨æ³•ä¸Reduxæ˜¯ä¸€æ ·çš„ã€‚

reducer()æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ ¹æ®åŠ¨ä½œç±»å‹å¤„ç†çŠ¶æ€ã€‚

[![reducer](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P573_28057.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P573_28057.jpg)

å®Œæ•´useReducer()ç”¨æ³•ï¼š
[![useReducer](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P573_28065.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P573_28065.jpg)

åœ¨Reactä¸­ï¼Œå¦‚æœä½ æƒ³åœ¨ä½¿ç”¨useReduceræ—¶ä¼ é€’é¢å¤–çš„å‚æ•°ç»™dispatchå‡½æ•°ä»¥ä¿®æ”¹stateï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªå¸¦æœ‰å‚æ•°çš„å‡½æ•°ï¼Œç„¶åå°†å…¶ä¼ é€’ç»™dispatchã€‚ä»¥ä¸‹æ˜¯ä¸€ç§æ–¹æ³•ï¼š

```jsx
import React, { useReducer } from 'react';

// å®šä¹‰ reducer å‡½æ•°
const reducer = (state, action) => {
  switch (action.type) {
    case 'INCREMENT':
      return { count: state.count + action.value };
    default:
      return state;
  }
};

const Counter = () => {
  // åˆå§‹ state
  const initialState = { count: 0 };

  // ä½¿ç”¨ useReducer
  const [state, dispatch] = useReducer(reducer, initialState);

  // å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºä¼ é€’é¢å¤–çš„å‚æ•°ç»™ dispatch
  const incrementCount = (value) => {
    dispatch({ type: 'INCREMENT', value });
  };

  return (
    <div>
      Count: {state.count}
      {/* è°ƒç”¨å‡½æ•°å¹¶ä¼ é€’é¢å¤–çš„å‚æ•° */}
      <button onClick={() => incrementCount(5)}>Increment</button>
    </div>
  );
};

export default Counter;
```

### è‡ªå®šä¹‰Hooks

è‡ªå®šä¹‰Hookçš„ä¸»è¦ç›®çš„æ˜¯é‡ç”¨ç»„ä»¶ä¸­ä½¿ç”¨çš„é€»è¾‘ã€‚æ„å»ºè‡ªå·±çš„Hookå¯ä»¥è®©å¼€å‘è€…å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚

è‡ªå®šä¹‰Hookæ˜¯å¸¸è§„çš„JavaScriptå‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–Hookï¼Œåªè¦å®ƒä»¬éµå¾ªHookçš„è§„åˆ™ã€‚

æ­¤å¤–ï¼Œè‡ªå®šä¹‰Hookçš„åç§°å¿…é¡»ä»¥å•è¯useå¼€å¤´ã€‚

#### useCounter

å®ç°ä¸€ä¸ªè®¡æ•°å™¨åº”ç”¨ï¼Œå®ƒçš„å€¼å¯ä»¥é€’å¢ã€é€’å‡æˆ–é‡ç½®ã€‚

[![custom hooks](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P574_28231.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P574_28231.jpg)

ä½¿ç”¨useCounter:

[![ä½¿ç”¨useCounter](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P575_28267.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P575_28267.jpg)

é€šè¿‡è¿™ç§æ–¹å¼å¯ä»¥å°†Appç»„ä»¶çš„çŠ¶æ€åŠå…¶æ“ä½œå®Œå…¨æå–åˆ°useCounter Hookä¸­ï¼Œç®¡ç†è®¡æ•°å™¨çŠ¶æ€å’Œé€»è¾‘ç°åœ¨æ˜¯è‡ªå®šä¹‰Hookçš„è´£ä»»ã€‚

#### useField

[![useField](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P577_28498.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P577_28498.jpg)

ä½¿ç”¨useField:

[![ä½¿ç”¨useField](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P578_28516.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P578_28516.jpg)

ç®€åŒ–ï¼š

[![ç®€åŒ–](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P578_28559.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P578_28559.jpg)

è¡¨å•ä¸­ä½¿ç”¨ï¼š

[![è¡¨å•ä¸­ä½¿ç”¨useField](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P578_28591.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P578_28591.jpg)

å½“ä¸åŒæ­¥è¡¨å•çŠ¶æ€æœ‰å…³çš„æ¼äººçš„ç»†èŠ‚è¢«å°è£…åœ¨è‡ªå®šä¹‰Hookä¸­æ—¶ï¼Œè¡¨å•çš„å¤„ç†å°±å¤§å¤§ç®€åŒ–äº†ã€‚è‡ªå®šä¹‰Hookæ˜¾ç„¶ä¸ä»…æ˜¯ä¸€ç§å¯é‡ç”¨çš„å·¥å…·ï¼Œå®ƒä»¬è¿˜ä¸ºå°†ä»£ç åˆ’åˆ†ä¸ºæ›´å°çš„æ¨¡å—æä¾›äº†ä¸€ç§æ›´å¥½çš„æ–¹å¼ã€‚

## äºŒã€è·¯ç”±React Router

React Routeråº“æ˜¯Reactå®˜æ–¹é…å¥—çš„è·¯ç”±æ¨¡å—ï¼Œç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯v6,v6ç‰ˆæœ¬å’Œä¹‹å‰çš„ç‰ˆæœ¬æ¯”è¾ƒæœ‰äº†è¾ƒå¤§çš„æ”¹è¿›ã€‚åœ¨v6ç‰ˆæœ¬çš„è·¯ç”±ä¸­åœ¨å¤–å±‚ç»Ÿä¸€é…ç½®è·¯ç”±ç»“æ„ï¼Œè®©è·¯ç”±ç»“æ„æ›´æ¸…æ™°ï¼Œé€šè¿‡Outletå®ç°å­ä»£è·¯ç”±çš„æ¸²æŸ“ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šæœ‰ç‚¹ç±»ä¼¼äºVueä¸­çš„view-routerã€‚

React Routerä¸­åŒ…å«3ä¸ªä¸åŒçš„æ¨¡å—ï¼Œæ¯ä¸ªåŒ…éƒ½æœ‰ä¸åŒçš„ç”¨é€”ã€‚å®˜æ–¹ç½‘å€ä¸ºhttps://reactrouter.com/docs/en/v6/api

[![React Router](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T579_43460.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T579_43460.jpg)

[![React Routeræ¨¡å—](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P580_28708.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P580_28708.jpg)

#### å®‰è£…

```bash
npm install react-router-dom@6

yarn add react-router-dom@6

pnpm add react-router-dom@6
```

### è·¯ç”±æ¨¡å¼

react-router-domæ”¯æŒä¸¤ç§æ¨¡å¼è·¯ç”±ï¼šHashRouterå’ŒBrowserRouterã€‚

[![react router](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T580_43464.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T580_43464.jpg)

ä½¿ç”¨React Router:

[![react router](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P581_28755.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P581_28755.jpg)

v6ç‰ˆæœ¬è·¯ç”±é‡‡ç”¨äº†Routerâ†’Routesâ†’Routeç»“æ„ï¼Œè·¯ç”±æœ¬è´¨åœ¨äºRoutesç»„ä»¶ï¼Œå½“locationä¸Šä¸‹æ–‡æ”¹å˜æ—¶ï¼ŒRoutesé‡æ–°æ¸²æŸ“ï¼Œé‡æ–°å½¢æˆæ¸²æŸ“åˆ†æ”¯ï¼Œç„¶åé€šè¿‡Provideræ–¹å¼é€å±‚ä¼ é€’Outletï¼Œè¿›è¡ŒåŒ¹é…æ¸²æŸ“ã€‚

[![react router](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T581_43468.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T581_43468.jpg)

ä¸ºäº†æ›´å¥½åœ°æ”¯æŒHookç”¨æ³•ï¼Œv6ç‰ˆæœ¬ä¸­æä¾›äº†è·¯ç”±Hook:

[![react router hook](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T582_29037.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-T582_29037.jpg)

#### ä½¿ç”¨

[![react routerä½¿ç”¨](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P582_28971.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P582_28971.jpg)

[![App.js](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P582_29011.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P582_29011.jpg)

[![Home.jsAbount.js](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P583_29121.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P583_29121.jpg)

### åµŒå¥—è·¯ç”±

åµŒå¥—æ¨¡å¼è·¯ç”±æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå½“è·¯ç”±è¢«åµŒå¥—æ—¶ï¼Œä¸€èˆ¬è®¤ä¸ºç½‘é¡µçš„æŸä¸€éƒ¨åˆ†ä¿æŒä¸å˜ï¼Œåªæœ‰ç½‘é¡µçš„å­éƒ¨åˆ†å‘ç”Ÿå˜åŒ–ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœè®¿é—®ä¸€ä¸ªç®€å•çš„ç”¨æˆ·ç®¡ç†é¡µé¢ï¼Œåˆ™å§‹ç»ˆæ˜¾ç¤ºè¯¥ç”¨æˆ·çš„æ ‡é¢˜ï¼Œç„¶ååœ¨å…¶ä¸‹æ–¹æ˜¾ç¤ºç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œä½†æ˜¯ï¼Œå½“å•å‡»ä¿®æ”¹ç”¨æˆ·æ—¶ï¼Œç”¨æˆ·è¯¦æƒ…é¡µå°†æ›¿æ¢ä¸ºç”¨æˆ·ä¿®æ”¹é¡µé¢ã€‚åœ¨React Router v5ä¸­ï¼Œå¿…é¡»æ˜ç¡®å®šä¹‰åµŒå¥—æ¨¡å¼è·¯ç”±ï¼ŒReact Router v6æ›´åŠ ç®€å•ã€‚React Routeråº“ä¸­çš„Outletç»„ä»¶å¯ä»¥ä¸ºç‰¹å®šè·¯ç”±å‘ˆç°ä»»ä½•åŒ¹é…çš„å­å…ƒç´ ã€‚é¦–å…ˆï¼Œä»react-router-domåº“ä¸­å¯¼å…¥Outletï¼Œä»£ç å¦‚ä¸‹ï¼š

```tsx
import { Outlet } from "react-router-dom";
```

åœ¨çˆ¶ç»„ä»¶(User.js)ä¸­ä½¿ç”¨Outletç»„ä»¶ï¼Œè¯¥ç»„ä»¶ç”¨æ¥æ˜¾ç¤ºåŒ¹é…å­è·¯ç”±çš„é¡µé¢ã€‚

User.js:

```jsx
function User() {
  return (
    <div>
      <h1>User</h1>
      <Outlet />
    </div>
  )
}
```

å®šä¹‰åµŒå¥—æ¨¡å¼è·¯ç”±(Routeä¸­åµŒå¥—Routeç»„ä»¶)ï¼Œåœ¨åµŒå¥—æ¨¡å¼è·¯ç”±ä¸­ï¼Œå¦‚æœURLä»…åŒ¹é…äº†çˆ¶çº§URLï¼Œåˆ™Outletä¸­ä¼šæ˜¾ç¤ºå¸¦æœ‰indexå±æ€§çš„è·¯ç”±ã€‚

[![åµŒå¥—è·¯ç”±](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P585_29304.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P585_29304.jpg)

å½“URLä¸º/useræ—¶ï¼ŒUserä¸­çš„Outletä¼šæ˜¾ç¤ºDefaultç»„ä»¶ã€‚

å½“URLä¸º/user/createæ—¶ï¼ŒUserä¸­çš„Outletä¼šæ˜¾ç¤ºNewUserç»„ä»¶ã€‚

### è·¯ç”±å‚æ•°

ä¸‹é¢ä»‹ç»ä¸¤ç§è·å–è·¯ç”±å‚æ•°çš„æ–¹å¼ï¼Œå³è·å–paramså‚æ•°çš„æ–¹å¼å’Œè·å–searchå‚æ•°çš„æ–¹å¼ã€‚

#### paramå‚æ•°

åœ¨Routeç»„ä»¶çš„pathå±æ€§ä¸­å®šä¹‰è·¯å¾„å‚æ•°ï¼Œåœ¨ç»„ä»¶å†…é€šè¿‡useParamsé’©å­è®¿é—®è·¯å¾„å‚æ•°ã€‚

[![useParam](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P585_29421.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P585_29421.jpg)

#### searchå‚æ•°

å’Œvue routerä¸­çš„queryå·®ä¸å¤šã€‚

æŸ¥è¯¢å‚æ•°ä¸éœ€è¦åœ¨è·¯ç”±ä¸­å®šä¹‰ã€‚ä½¿ç”¨useSearchParamsé’©å­è®¿é—®æŸ¥è¯¢å‚æ•°ï¼Œå…¶ç”¨æ³•å’ŒuseStateç±»ä¼¼ï¼Œä¼šè¿”å›å½“å‰å¯¹è±¡å’Œæ›´æ”¹å®ƒçš„æ–¹æ³•ã€‚æ›´æ”¹searchParamsæ—¶ï¼Œå¿…é¡»ä¼ å…¥æ‰€æœ‰çš„æŸ¥è¯¢å‚æ•°ï¼Œå¦åˆ™ä¼šè¦†ç›–å·²æœ‰å‚æ•°ã€‚

[![useSearch](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P586_29490.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P586_29490.jpg)

### ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª

åœ¨React Router v6ä¸­ï¼Œç¼–ç¨‹å¼è·¯ç”±å¯¼èˆªç”¨`useNavigate`ä»£æ›¿`useHistory`ï¼Œå°†`history.push()`æ›¿æ¢ä¸º`navigation()`ã€‚

[![ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P586_29513.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P586_29513.jpg)

### å¤šä¸ª `<Routes />`

ä»¥å‰åªèƒ½åœ¨React Appä¸­ä½¿ç”¨ä¸€ä¸ªè·¯ç”±ï¼Œä½†æ˜¯ç°åœ¨å¯ä»¥åœ¨React Appä¸­ä½¿ç”¨å¤šä¸ªè·¯ç”±ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬åŸºäºä¸åŒçš„è·¯ç”±ç®¡ç†å¤šä¸ªåº”ç”¨ç¨‹åºé€»è¾‘ã€‚

[![å¤šä¸ªRoutes](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P587_29543.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P587_29543.jpg)

## ä¸‰ã€Redux

éšç€Reactå¼€å‘çš„ç»„ä»¶çš„ç»“æ„è¶Šæ¥è¶Šå¤æ‚ï¼Œæ·±å±‚çš„ç»„ä»¶åµŒå¥—å’Œç»„ä»¶æ ‘ä¸­çš„çŠ¶æ€æµåŠ¨ä¼šå˜å¾—éš¾ä»¥æ§åˆ¶ï¼Œè·Ÿè¸ªå’Œæµ‹è¯•èŠ‚ç‚¹çš„stateæµåŠ¨åˆ°å­èŠ‚ç‚¹æ—¶äº§ç”Ÿçš„å˜åŒ–è¶Šå‘å›°éš¾ã€‚è¿™ä¸ªæ—¶å€™å°±éœ€è¦è¿›è¡ŒçŠ¶æ€ç®¡ç†äº†ã€‚ä¸ºäº†è§£å†³ç»„ä»¶æ ‘çš„çŠ¶æ€ç®¡ç†çš„é—®é¢˜ï¼ŒReactæ¨å‡ºäº†Fluxæ•°æ®æµç®¡ç†æ¡†æ¶ã€‚

Fluxæœ¬èº«æ˜¯ä¸€ä¸ªæ¶æ„æ€æƒ³ï¼Œå®ƒæœ€é‡è¦çš„æ¦‚å¿µæ˜¯å•å‘æ•°æ®æµï¼Œæ˜¯å°†åº”ç”¨ä¸­çš„stateè¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œé€šè¿‡å‘å¸ƒï¼è®¢é˜…æ¨¡å¼è¿›è¡ŒçŠ¶æ€çš„æ›´æ–°ä¸ä¼ é€’ã€‚

[![Flux](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P588_29646.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P588_29646.jpg)

Fluxå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œå¦‚ä¸€ä¸ªåº”ç”¨å¯ä»¥æ‹¥æœ‰å¤šä¸ªStoreï¼Œå¤šä¸ªStoreä¹‹é—´å¯èƒ½æœ‰ä¾èµ–å…³ç³»ï¼Œä¹Ÿå¯èƒ½ç›¸äº’å¼•ç”¨ï¼ŒStoreå°è£…äº†æ•°æ®å’Œå¤„ç†æ•°æ®çš„é€»è¾‘ã€‚

[![Flux](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P588_29649.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P588_29649.jpg)

ç›®å‰ç¤¾åŒºå‡ºç°äº†ä¸€ç³»åˆ—çš„å‰ç«¯çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆï¼Œå¦‚éµå¾ªFluxæ€æƒ³çš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆä¸»è¦æœ‰Reduxã€Vuexã€ZustandåŠReactè‡ªå¸¦çš„useReducer+Contextã€‚

### Reduxä»‹ç»

Reduxæ˜¯ç›®å‰æœ€çƒ­é—¨çš„çŠ¶æ€ç®¡ç†åº“ä¹‹ä¸€ï¼Œå®ƒå—åˆ°Elmçš„å¯å‘ï¼Œæ˜¯ä»Fluxå•é¡¹æ•°æ®æµæ¶æ„æ¼”å˜è€Œæ¥çš„ã€‚

Reduxçš„æ ¸å¿ƒåŸºäºå‘å¸ƒå’Œè®¢é˜…æ¨¡å¼ã€‚Viewè®¢é˜…äº†Storeçš„å˜åŒ–ï¼Œä¸€æ—¦StoreçŠ¶æ€å‘ç”Ÿæ”¹å˜å°±ä¼šé€šçŸ¥æ‰€æœ‰çš„è®¢é˜…è€…ï¼ŒViewæ¥æ”¶åˆ°é€šçŸ¥ä¹‹åä¼šè¿›è¡Œé‡æ–°æ¸²æŸ“ã€‚

[![Redux](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P588_29654.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P588_29654.jpg)

Reduxéµå¾ªFluxæ€æƒ³ï¼ŒReduxå°†çŠ¶æ€ä»¥ä¸€ä¸ªå¯JSONåºåˆ—åŒ–çš„å¯¹è±¡çš„å½¢å¼å­˜å‚¨åœ¨å•ä¸ªStoreä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´Reduxå°†çŠ¶æ€é›†ä¸­å­˜å‚¨ã€‚Reduxé‡‡ç”¨å•å‘æ•°æ®æµçš„å½¢å¼ï¼Œå¦‚æœè¦ä¿®æ”¹Storeä¸­çš„çŠ¶æ€ï¼Œåˆ™å¿…é¡»é€šè¿‡Storeçš„dispatch()æ–¹æ³•ã€‚è°ƒç”¨store.dispatch()ä¹‹åï¼ŒStoreä¸­çš„rootReducer()ä¼šè¢«è°ƒç”¨ï¼Œè¿›è€Œè°ƒç”¨æ‰€æœ‰çš„Reducer()å‡½æ•°ç”Ÿæˆä¸€ä¸ªæ–°çš„stateã€‚

### Reduxçš„åŸºæœ¬åŸåˆ™

(1)å•ä¸€æ•°æ®æºï¼šæ•´ä¸ªåº”ç”¨çš„stateè¢«å‚¨å­˜åœ¨ä¸€æ£µå¯¹è±¡æ ‘ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡æ ‘åªå­˜åœ¨äºå”¯ä¸€ä¸€ä¸ªStoreä¸­ã€‚

(2)stateæ˜¯åªè¯»çš„ï¼šå”¯ä¸€æ”¹å˜stateçš„æ–¹æ³•å°±æ˜¯`è§¦å‘Action`,Actionæ˜¯ä¸€ä¸ªç”¨äºæè¿°å·²å‘ç”Ÿäº‹ä»¶çš„æ™®é€šå¯¹è±¡ã€‚

(3)ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹ï¼šä¸ºäº†æè¿°Actionå¦‚ä½•æ”¹å˜çŠ¶æ€æ ‘ï¼Œéœ€è¦ç¼–å†™`Reducer()å‡½æ•°`ã€‚

### æ ¸å¿ƒç»„æˆ

Reduxçš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†åŒ…æ‹¬Actionã€Reducerã€Storeã€‚

(1)Action:Actionå°±æ˜¯ä¸€ä¸ªæè¿°å‘ç”Ÿä»€ä¹ˆçš„å¯¹è±¡ã€‚

(2)Reducerï¼šå½¢å¼ä¸º(state,action)=>stateçš„çº¯å‡½æ•°ï¼ŒåŠŸèƒ½æ˜¯æ ¹æ®Actionä¿®æ”¹stateå¹¶å°†å…¶è½¬å˜æˆä¸‹ä¸€ä¸ªstateã€‚

(3)Storeï¼šç”¨äºå­˜å‚¨stateï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªå®¹å™¨ï¼Œæ•´ä¸ªåº”ç”¨åªèƒ½æœ‰ä¸€ä¸ªStoreã€‚

Reduxåº”ç”¨ä¸­æ‰€æœ‰çš„stateéƒ½ä»¥ä¸€ä¸ªå¯¹è±¡æ ‘çš„å½¢å¼å‚¨å­˜åœ¨ä¸€ä¸ªå•ä¸€çš„Storeä¸­ã€‚å”¯ä¸€æ”¹å˜stateçš„åŠæ³•æ˜¯è§¦å‘Action,Actionå°±æ˜¯ä¸€ä¸ªæè¿°å‘ç”Ÿä»€ä¹ˆçš„å¯¹è±¡ã€‚ä¸ºäº†æè¿°Actionå¦‚ä½•æ”¹å˜stateæ ‘ï¼Œéœ€è¦ç¼–å†™Reducer()å‡½æ•°ã€‚

### ReduxåŸºæœ¬ç”¨æ³•

#### å®‰è£…

Reduxæ˜¯é€šç”¨çš„çŠ¶æ€æ¡†æ¶ï¼Œå¦‚æœåœ¨Reactä¸­ä½¿ç”¨Reduxï¼Œåˆ™éœ€è¦å•ç‹¬å®‰è£…react-reduxæ’ä»¶:

```bash
npm i --save redux
npm i --save react-redux
npm i --save--dev redux-devtools
```

Reduxçš„å®˜æ–¹ç½‘ç«™ä¸ºhttps://github.com/reduxjs/reduxå’Œhttps://redux.js.org/ã€‚

#### åˆ›å»ºStore

åˆ›å»ºçŠ¶æ€ç®¡ç†ä»“åº“æ˜¯Reduxçš„ç¬¬ä¸€æ­¥ï¼Œåœ¨Reduxçš„APIä¸­æä¾›ä¸€ä¸ªcreateStore()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªreducerå’Œä¸€ä¸ªå¯é€‰middlewareä¸­é—´ä»¶å‚æ•°ã€‚

å¦‚æœæŠŠStoreæ¯”ä½œä¸€ä¸ªä»“åº“ï¼Œåˆ™Reducerå°±æ˜¯è¿™ä¸ªä»“åº“çš„ç®¡ç†ä¸­å¿ƒï¼Œä¸€ä¸ªä»“åº“å¯ä»¥æ ¹æ®ä¸åŒçš„çŠ¶æ€ç±»å‹(state)è®¾ç½®å¤šä¸ªä¸åŒçš„çŠ¶æ€ç®¡ç†ä¸­å¿ƒ(Reducer)ï¼Œæ¯ä¸ªReducerè´Ÿè´£æ ¹æ®å¼€å‘è€…çš„ä¸šåŠ¡éœ€æ±‚æ¥å¤„ç†ä»“åº“ä¸­çš„åŸå§‹çŠ¶æ€ï¼Œå¹¶è¿”å›æ–°çš„çŠ¶æ€ã€‚Reducerå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¤„ç†stateçš„å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸­è®¾ç½®äº†å¾ˆå¤šæ¡ä»¶ï¼Œè¿™äº›æ¡ä»¶æ˜¯å¼€å‘è€…æ ¹æ®å…·ä½“çš„ä¸šåŠ¡è®¾ç½®çš„ï¼Œä¸åŒçš„æ¡ä»¶è¯·æ±‚å¤„ç†ä¸åŒçš„çŠ¶æ€æ›´æ–°ã€‚

[![åˆ›å»ºstore](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P590_29681.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P590_29681.jpg)

#### æäº¤Actionå’Œè®¢é˜…Store

åˆ›å»ºå¥½çŠ¶æ€ç®¡ç†ä»“åº“åï¼Œåˆ›å»ºä¸€ä¸ªReactç»„ä»¶ï¼Œåœ¨ç»„ä»¶ä¸­è®¢é˜…ä»“åº“çš„çŠ¶æ€ï¼Œç»„ä»¶ä¸­é€šè¿‡dispatch()æ–¹æ³•ç»™ä»“åº“å‘é€äº‹ä»¶ä»¥ä¾¿æ›´æ–°ä»“åº“çŠ¶æ€ã€‚

[![ä½¿ç”¨store](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P590_29695.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P590_29695.jpg)

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œåœ¨useEffect()æ–¹æ³•ä¸­ï¼Œè®¢é˜…è·å–Storeä¸­æœ€æ–°çš„çŠ¶æ€ï¼Œå•å‡»æŒ‰é’®ï¼Œé€šè¿‡store.dispatch({type:'ADD'})å°†åŠ¨ä½œç±»å‹å‘é€ç»™Storeä¸­çš„Reducerå¤„ç†ï¼Œå¹¶è¿”å›æœ€æ–°çš„çŠ¶æ€ã€‚

#### ä½¿ç”¨react-reduxç»‘å®šstore

åœ¨ä¸Šé¢çš„æ­¥éª¤ä¸­ï¼Œæ‰‹åŠ¨è®¢é˜…äº†ä»“åº“ï¼Œä½†æ˜¯è¿™æ ·æ¯”è¾ƒéº»çƒ¦ï¼ŒReduxå®˜æ–¹æä¾›äº†ä¸€ä¸ªreact-reduxåº“ï¼Œå¸®åŠ©æˆ‘ä»¬åœ¨Reactä¸­ä½¿ç”¨Reduxã€‚

react-reduxæä¾›ä¸€ä¸ªé«˜é˜¶ç»„ä»¶Connect,connect()æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæœ¨å¶ç»„ä»¶ï¼ˆæ— çŠ¶æ€ç»„ä»¶ï¼‰å¹¶é€šè¿‡mapStateToPropsï¼ˆæŠŠstoreçš„çŠ¶æ€ç»‘å®šåˆ°æœ¨å¶ç»„ä»¶çš„propsä¸Šï¼‰å’ŒmapDispatchToPropsï¼ˆæŠŠdispatchç»‘å®šåˆ°æœ¨å¶ç»„ä»¶ä¸­çš„propsä¸Šï¼‰æŠŠç»„ä»¶å’Œä»“åº“è¿›è¡Œç»‘å®šï¼Œæ— é¡»å¼€å‘è€…è¿›è¡Œæ‰‹åŠ¨è®¢é˜…å’Œå–æ¶ˆè®¢é˜…ã€‚

é¦–å…ˆï¼Œéœ€è¦æŠŠReduxDemoç»„ä»¶æ”¹é€ ä¸ºæœ¨å¶ç»„ä»¶ï¼Œå°†é‡Œé¢çš„numå’Œå•å‡»äº‹ä»¶æ›´æ”¹ä¸ºä»å¤–éƒ¨ä¼ å…¥propsï¼Œä¿è¯ç»„ä»¶æ˜¯æ— çŠ¶æ€çš„ã€‚

æŠŠreduxdemoç»„ä»¶æ”¹ä¸ºæœ¨å¶ç»„ä»¶ï¼š

[![æœ¨å¶ç»„ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P591_29769.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P591_29769.jpg)

é€šè¿‡Connecté«˜é˜¶ç»„ä»¶å°†ä¸Šé¢çš„ç»„ä»¶è½¬æ¢ä¸ºè¿æ¥Storeçš„æ™ºèƒ½ç»„ä»¶ã€‚mapStateToPropsæŠŠä»“åº“ä¸­çš„stateæ˜ å°„åˆ°numä¸Šï¼ŒmapDispatchToPropsæŠŠonAddClickæ˜ å°„åˆ°dispatch()æ–¹æ³•ä¸Šï¼š

[![connect](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P591_29813.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P591_29813.jpg)

ä¿®æ”¹renderå…¥å£ï¼Œéœ€è¦æ·»åŠ react-reduxæä¾›çš„ä¸€ä¸ªç»„ä»¶`Provider`ï¼Œé€šè¿‡Provider`å±æ€§store`ç»‘å®š`åˆ›å»ºçš„ä»“åº“`:

[![renderå…¥å£](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P592_29843.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P592_29843.jpg)

### Reduxæ ¸å¿ƒå¯¹è±¡

#### Action

åŠ¨ä½œå¯¹è±¡ï¼Œç”¨æ¥æè¿°ä¸€ä¸ªåŠ¨ä½œï¼Œä¸€èˆ¬åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªå±æ€§ã€‚

(1)typeï¼šæ ‡è¯†å±æ€§ï¼Œå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œå”¯ä¸€ã€å¿…è¦å±æ€§ã€‚

(2)dataï¼šæ•°æ®å±æ€§ï¼Œå€¼ç±»å‹ä»»æ„ï¼Œå¯é€‰å±æ€§ã€‚

[![action](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P592_29883.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P592_29883.jpg)

#### Action Creators

è€ƒè™‘åˆ°å¯¹å®ƒçš„å¤ç”¨ï¼ŒActionå¯ä»¥é€šè¿‡ç”Ÿæˆå™¨(ActionCreators)æ¥åˆ›å»ºã€‚å…¶å®å®ƒå°±æ˜¯è¿”å›Actionå¯¹è±¡çš„å‡½æ•°ï¼ˆè‡ªå®šä¹‰çš„å‡½æ•°ï¼‰ã€‚

[![actionCreators](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P593_29895.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P593_29895.jpg)

#### Reducer

Reducerçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œå®ƒç”¨æ¥å“åº”å‘é€è¿‡æ¥çš„Actionsï¼Œç„¶åç»è¿‡å¤„ç†æŠŠstateå‘é€ç»™Storeã€‚åœ¨Reducerå‡½æ•°ä¸­é€šè¿‡returnè¿”å›å€¼ï¼Œè¿™æ ·Storeæ‰èƒ½æ¥æ”¶åˆ°æ•°æ®ï¼ŒReducerä¼šæ¥æ”¶åˆ°ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯åˆå§‹åŒ–çš„stateï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯å‘é€è¿‡æ¥çš„Actionã€‚

[![reducer](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P593_29903.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P593_29903.jpg)

#### combineReducers()

çœŸæ­£å¼€å‘é¡¹ç›®æ—¶stateæ¶‰åŠå¾ˆå¤šåŠŸèƒ½ï¼Œåœ¨ä¸€ä¸ªReducerä¸­å¤„ç†æ‰€æœ‰é€»è¾‘ä¼šéå¸¸æ··ä¹±ï¼Œæ‰€ä»¥éœ€è¦æ‹†åˆ†æˆå¤šä¸ªå°Reducerï¼Œæ¯ä¸ªReduceråªå¤„ç†å®ƒç®¡ç†çš„é‚£éƒ¨åˆ†stateæ•°æ®ï¼Œç„¶åå†ç”±ä¸€ä¸ªä¸»rootReducersæ¥ä¸“é—¨ç®¡ç†è¿™äº›å°Reducerã€‚

Reduxæä¾›äº†ä¸€ç§æ–¹æ³•combineReducers()ä¸“é—¨æ¥ç®¡ç†è¿™äº›å°Reducerã€‚

[![combineReducers()](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P594_29914.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P594_29914.jpg)

#### Store

Storeç”¨äºå­˜å‚¨åº”ç”¨ä¸­æ‰€æœ‰ç»„ä»¶çš„stateçŠ¶æ€ï¼Œä¹Ÿä»£è¡¨ç€ç»„ä»¶çŠ¶æ€çš„æ•°æ®æ¨¡å‹ï¼Œå®ƒæä¾›ç»Ÿä¸€çš„APIæ–¹æ³•æ¥å¯¹stateè¿›è¡Œè¯»å–ã€æ›´æ–°ã€ç›‘å¬ç­‰æ“ä½œã€‚

Storeæœ¬èº«æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨Reduxåº”ç”¨ä¸­Storeå…·æœ‰å•ä¸€æ€§ï¼Œå¹¶ä¸”é€šè¿‡å‘createStore()å‡½æ•°ä¸­ä¼ å…¥Reduceræ¥åˆ›å»ºStoreã€‚å…¶å¦ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯ä½œä¸ºè¿æ¥Actionä¸Reducerçš„æ¡¥æ¢ã€‚

[![store](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P594_29922.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P594_29922.jpg)

### Reduxä¸­é—´ä»¶

Reduxçš„ä¸­é—´ä»¶(Middleware)éµå¾ªäº†å³æ’å³ç”¨çš„è®¾è®¡æ€æƒ³ï¼Œå‡ºç°åœ¨Actionåˆ°è¾¾Reducerä¹‹å‰çš„ä½ç½®ã€‚

ä¸­é—´ä»¶æ˜¯ä¸€ä¸ªå…·æœ‰å›ºå®šæ¨¡å¼çš„ç‹¬ç«‹å‡½æ•°ï¼Œå½“æŠŠå¤šä¸ªä¸­é—´ä»¶åƒç®¡é“é‚£æ ·ä¸²è”åœ¨ä¸€èµ·æ—¶ï¼Œå‰ä¸€ä¸ªä¸­é—´ä»¶ä¸ä½†èƒ½å°†å…¶è¾“å‡ºä¼ ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ä½œä¸ºè¾“å…¥ï¼Œè¿˜èƒ½ä¸­æ–­æ•´æ¡ç®¡é“ã€‚

åœ¨å¼•å…¥ä¸­é—´ä»¶åï¼Œæ—¢èƒ½æ‰©å±•Reduxçš„åŠŸèƒ½ï¼Œä¹Ÿèƒ½å¢å¼ºdispatch()å‡½æ•°çš„åŠŸèƒ½ï¼Œä»¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ï¼Œä¾‹å¦‚é€šè¿‡ä¸­é—´ä»¶è®°å½•æ—¥å¿—ã€æŠ¥å‘Šå¥”æºƒæˆ–å¤„ç†å¼‚æ­¥è¯·æ±‚ç­‰ã€‚

[![ä¸­é—´ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P594_29927.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P594_29927.jpg)

#### ä¸­é—´ä»¶æ¥å£

åœ¨è®¾è®¡ä¸­é—´ä»¶å‡½æ•°æ—¶ï¼Œä¼šéµå¾ªä¸€ä¸ªå›ºå®šçš„æ¨¡å¼ï¼Œä¸‹é¢çš„ä»£ç ä½¿ç”¨äº†æŸ¯é‡ŒåŒ–ã€é«˜é˜¶å‡½æ•°ç­‰å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µï¼š

[![ä¸­é—´ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P594_29935.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P594_29935.jpg)

ES6è¯­æ³•ï¼š

[![ä¸­é—´ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P595_29945.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P595_29945.jpg)

middleware()å‡½æ•°æ¥æ”¶ä¸€ä¸ªStoreå®ä¾‹ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæ¥æ”¶nextå‚æ•°çš„å‡½æ•°ï¼Œå…¶ä¸­nextä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥å°†æ§åˆ¶æƒè½¬ç§»ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä»è€Œå®ç°ä¸­é—´ä»¶ä¹‹é—´çš„ä¸²è”ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªå¤„ç†Actionå¯¹è±¡çš„å‡½æ•°ã€‚

ç”±äºé—­åŒ…çš„ä½œç”¨ï¼Œåœ¨è¿™æœ€å†…å±‚çš„å‡½æ•°ä¸­ï¼Œä¾ç„¶èƒ½è°ƒç”¨å¤–å±‚çš„å¯¹è±¡å’Œå‡½æ•°ï¼Œä¾‹å¦‚è®¿é—®Actionæ‰€æºå¸¦çš„æ•°æ®ã€æ‰§è¡Œ`Storeä¸­çš„dispatch()æˆ–getState()æ–¹æ³•`ç­‰ã€‚

ç¤ºä¾‹ä¸­çš„middleware()å‡½æ•°åªæ˜¯å•çº¯åœ°å°†æ¥æ”¶çš„actionå¯¹è±¡`è½¬äº¤`ç»™åé¢çš„ä¸­é—´ä»¶ï¼Œè€Œæ²¡æœ‰å¯¹å…¶åšé¢å¤–çš„å¤„ç†ã€‚

#### åˆ›å»ºä¸€ä¸ªæ—¥å¿—ä¸­é—´ä»¶

è¯¥ä¸­é—´ä»¶ï¼Œæ‰“å°ç»„ä»¶å‘é€è¿‡æ¥çš„Actionï¼Œå»¶è¿Ÿ1sï¼Œé‡æ„ä¸€ä¸ªæ–°çš„Actionäº¤ç»™Reducerå¤„ç†ã€‚

[![æ—¥å¿—ä¸­é—´ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P595_29963.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P595_29963.jpg)

#### æ³¨å†Œä¸­é—´ä»¶

ä¸­é—´ä»¶åœ¨å¼€å‘å®Œæˆä»¥ååªæœ‰è¢«æ³¨å†Œæ‰èƒ½åœ¨Reduxçš„å·¥ä½œæµç¨‹ä¸­ç”Ÿæ•ˆï¼ŒReduxä¸­æœ‰ä¸ªapplyMiddlewareï¼Œå…¶ä½œç”¨æ˜¯æ³¨å†Œä¸­é—´ä»¶ã€‚

[![æ³¨å†Œä¸­é—´ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P595_29984.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P595_29984.jpg)

### Reduxä¸­é—´ä»¶ï¼ˆredux-thunkï¼‰

å¦‚æœè¦åœ¨Reduxä¸­å¤„ç†å¼‚æ­¥è¯·æ±‚ï¼Œåˆ™å¯ä»¥å€ŸåŠ©ä¸­é—´ä»¶å®ç°ã€‚ç›®å‰å¸‚é¢ä¸Šå·²æœ‰å¾ˆå¤šå°è£…å¥½çš„ä¸­é—´ä»¶å¯ä¾›ä½¿ç”¨ï¼Œä¾‹å¦‚redux-thunkã€redux-promiseæˆ–redux-sagaç­‰ã€‚redux-thunkæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ä¸­é—´ä»¶ã€‚

[![redux-thunk](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P596_29996.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P596_29996.jpg)

é¦–å…ˆæ£€æµ‹Actionçš„ç±»å‹ï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œå°±ç›´æ¥è°ƒç”¨å¹¶å°†dispatchã€getStateå’ŒextraArgumentä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¦åˆ™å°±è°ƒç”¨nextå‚æ•°ï¼Œè½¬ç§»æ§åˆ¶æƒã€‚redux-thunkå…¶å®æ‰©å±•äº†dispatch()æ–¹æ³•ï¼Œä½¿å…¶å‚æ•°æ—¢å¯ä»¥æ˜¯JavaScriptå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°ã€‚

```bash
npm install redux-thunk --save
```

[![ä½¿ç”¨redux-thunk](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P596_30022.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P596_30022.jpg)

æ´¾å‘å¼‚æ­¥äº‹ä»¶ï¼š

[![æ´¾å‘å¼‚æ­¥äº‹ä»¶](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P597_30050.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P597_30050.jpg)

index.js

[![index.js](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P598_30128.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P598_30128.jpg)

### Reduxä¸­é—´ä»¶ï¼ˆredux-sagaï¼‰

redux-sagaæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†åº”ç”¨ç¨‹åºSide Effectï¼ˆå‰¯ä½œç”¨ï¼Œå¦‚å¼‚æ­¥è·å–æ•°æ®ã€è®¿é—®æµè§ˆå™¨ç¼“å­˜ç­‰ï¼‰çš„åº“ï¼Œå®ƒçš„ç›®æ ‡æ˜¯è®©å‰¯ä½œç”¨ç®¡ç†æ›´å®¹æ˜“ï¼Œæ‰§è¡Œæ›´é«˜æ•ˆï¼Œæµ‹è¯•æ›´ç®€å•ï¼Œåœ¨å¤„ç†æ•…éšœæ—¶æ›´å®¹æ˜“ã€‚

[![redux-saga](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P599_30166.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P599_30166.jpg)

redux-sagaæ˜¯ä¸€ä¸ªç”¨äºç®¡ç†Reduxåº”ç”¨å¼‚æ­¥æ“ä½œçš„ä¸­é—´ä»¶ï¼ˆåˆç§°å¼‚æ­¥Actionï¼‰ã€‚

redux-sagaé€šè¿‡åˆ›å»ºSagaå°†æ‰€æœ‰çš„å¼‚æ­¥æ“ä½œé€»è¾‘æ”¶é›†åœ¨ä¸€ä¸ªåœ°æ–¹é›†ä¸­å¤„ç†ï¼Œç”¨æ¥ä»£æ›¿redux-thunkä¸­é—´ä»¶ã€‚é€šè¿‡redux-sagaåº“æ¥å¤„ç†å‰¯ä½œç”¨ç›¸å…³æ“ä½œï¼ŒReduxçš„å„éƒ¨åˆ†çš„åä½œæ›´æ˜ç¡®ï¼š

(1)Reducerè´Ÿè´£å¤„ç†Actionçš„stateæ›´æ–°ã€‚

(2)Sagaè´Ÿè´£åè°ƒé‚£äº›å¤æ‚æˆ–å¼‚æ­¥çš„æ“ä½œã€‚

Sagaä¸åŒäºThunk,Thunkæ˜¯åœ¨Actionè¢«åˆ›å»ºæ—¶è°ƒç”¨ï¼Œè€ŒSagaåªä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨ï¼Œåˆå§‹å¯åŠ¨çš„Sagaå¯èƒ½ä¼šåŠ¨æ€è°ƒç”¨å…¶ä»–Saga,Sagaå¯ä»¥è¢«çœ‹ä½œåœ¨åå°è¿è¡Œçš„è¿›ç¨‹ï¼ŒSagaç›‘å¬å‘èµ·Actionï¼Œç„¶åå†³å®šåŸºäºè¿™ä¸ªActionæ¥åšä»€ä¹ˆï¼šæ˜¯å‘èµ·ä¸€ä¸ªå¼‚æ­¥è°ƒç”¨ï¼ˆå¦‚ä¸€ä¸ªfetchè¯·æ±‚ï¼‰ï¼Œè¿˜æ˜¯å‘èµ·å…¶ä»–çš„Actionåˆ°Storeï¼Œç”šè‡³æ˜¯è°ƒç”¨å…¶ä»–çš„Sagaã€‚

Sagaæ˜¯é€šè¿‡Generator()å‡½æ•°æ¥åˆ›å»ºçš„ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½é€šç”¨Yield Effectæ¥å®Œæˆã€‚Effectå¯ä»¥çœ‹ä½œredux-sagaçš„ä»»åŠ¡å•å…ƒï¼ŒEffectséƒ½æ˜¯ç®€å•çš„JavaScriptå¯¹è±¡ï¼ŒåŒ…å«è¦è¢«Saga Middlewareæ‰§è¡Œçš„ä¿¡æ¯ï¼Œredux-sagaä¸ºå„é¡¹ä»»åŠ¡æä¾›äº†å„ç§Effectåˆ›å»ºå™¨ï¼Œä¾‹å¦‚è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œå‘èµ·ä¸€ä¸ªActionåˆ°Storeï¼Œå¯åŠ¨ä¸€ä¸ªåå°ä»»åŠ¡æˆ–è€…ç­‰å¾…ä¸€ä¸ªæ»¡è¶³æŸäº›æ¡ä»¶çš„æœªæ¥çš„Actionã€‚

å†…éƒ¨æ˜¯ä½¿ç”¨äº†yieldå‡½æ•°ï¼Œæœ‰ç‚¹çœ‹ä¸æ‡‚è¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œganneratorå‡½æ•°ç”¨çš„ä¹Ÿæ¯”è¾ƒå°‘ï¼Œæš‚æ—¶ä¸äº†è§£äº†ã€‚

å¯ä»¥å‚è€ƒ[redux-saga](https://github.com/redux-saga/redux-saga)ã€‚

// TODO

### Redux Toolkit

Redux ToolkitåŒ…æ˜¯Reduxçš„å·¥å…·é›†ï¼Œæ—¨åœ¨è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

(1)Storeçš„é…ç½®å¤æ‚ã€‚

(2)æƒ³è®©Reduxæ›´åŠ å¥½ç”¨ï¼Œä¸éœ€è¦å®‰è£…å¤§é‡çš„é¢å¤–åŒ…ã€‚

(3)Reduxè¦æ±‚å†™å¾ˆå¤šæ¨¡æ¿ä»£ç ã€‚

#### configureStore

æä¾›ç®€åŒ–çš„é…ç½®é€‰é¡¹å’Œè‰¯å¥½çš„é»˜è®¤å€¼ã€‚å®ƒå¯ä»¥è‡ªåŠ¨ç»„åˆä¼—å¤šçš„Reducer()ï¼Œæ·»åŠ ç”¨æˆ·æä¾›çš„ä»»ä½•Reduxä¸­é—´ä»¶ï¼Œé»˜è®¤æƒ…å†µä¸‹åŒ…æ‹¬redux-thunkï¼ˆå¤„ç†å¼‚æ­¥Actionçš„ä¸­é—´ä»¶ï¼‰ï¼Œå¹¶æ”¯æŒä½¿ç”¨Redux DevToolsæ‰©å±•ã€‚

#### createReducer

åˆ›å»ºreducer()çš„Actionæ˜ å°„è¡¨è€Œä¸å¿…ç¼–å†™switchè¯­å¥ã€‚

è‡ªåŠ¨ä½¿ç”¨`Immeråº“`è®©å¼€å‘è€…ç”¨æ­£å¸¸çš„ä»£ç ç¼–å†™æ›´ç®€å•çš„ä¸å¯å˜æ›´æ–°ï¼Œä¾‹å¦‚state.todos[3].completed=trueã€‚

#### createAction

ä¸ºç»™å®šçš„æ“ä½œç±»å‹å­—ç¬¦ä¸²ç”Ÿæˆaction Creator()å‡½æ•°ã€‚

#### createSlice

ä¸ºç»™å®šçš„æ“ä½œç±»å‹å­—ç¬¦ä¸²ç”Ÿæˆaction Creator()å‡½æ•°ã€‚

[![createSlice](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P607_30447.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P607_30447.jpg)

#### createAsyncThunk

æ¥æ”¶Actionå­—ç¬¦ä¸²å’Œè¿”å›Promiseçš„å‡½æ•°ï¼Œå¹¶ç”Ÿæˆåˆ†æ´¾çš„thunk()å‡½æ•°ã€‚

#### createEntityAdapter

ç”Ÿæˆå¯é‡ç”¨çš„Reducerå’ŒSelectoræ¥ç®¡ç†Storeä¸­çš„æ•°æ®ï¼Œæ‰§è¡ŒCRUDæ“ä½œã€‚

#### createSlector

æ¥è‡ªReselectåº“ï¼Œè¢«é‡æ–°å¯¼å‡ºï¼Œç”¨äºstateç¼“å­˜ï¼Œé˜²æ­¢ä¸å¿…è¦çš„è®¡ç®—ã€‚

#### redux-toolkitç”¨æ³•

[![redux-toolkit](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P608_30498.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P608_30498.jpg)

1. åˆ›å»ºä¸€ä¸ªsrc/app/store.jsæ–‡ä»¶ï¼Œä»Redux Toolkité‡Œå¼•å…¥configureStoreï¼Œå°†ä»åˆ›å»ºå’Œå¯¼å‡ºä¸€ä¸ªç©ºçš„Redux Storeå¼€å§‹:

[![redux-toolkit](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P609_30513.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P609_30513.jpg)

2. ä¸€æ—¦Storeåˆ›å»ºå®Œæˆï¼Œå°±å¯ä»¥åœ¨src/index.jsæ–‡ä»¶ä¸­ç”¨react-reduxæä¾›çš„`<Provider>`åŒ…è£¹åº”ç”¨ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨React Storeäº†ã€‚å…·ä½“æ“ä½œå°±æ˜¯å…ˆå¼•å…¥åˆšåˆšåˆ›å»ºçš„Redux Storeï¼Œç„¶åç”¨`<Provider>`åŒ…è£¹`<App>`ï¼Œå†å°†Storeä½œä¸ºä¸€ä¸ªpropsä¼ å…¥:

[![index.js](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P609_30539.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P609_30539.jpg)

3. åˆ›å»ºä¸€ä¸ªsrc/features/counter/counterSlice.jsæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶é‡Œä»Redux Toolkitä¸­å¼•å…¥createSlice APIã€‚Sliceéœ€è¦ä¸€ä¸ªNameä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œéœ€è¦æœ‰åˆå§‹åŒ–Stateå€¼ï¼Œè¿˜éœ€è¦è‡³å°‘ä¸€ä¸ªreduceræ–¹æ³•æ¥å®šä¹‰Stateå¦‚ä½•å˜åŒ–ã€‚

ä¸€æ—¦Sliceåˆ›å»ºå®Œæˆå°±å¯ä»¥å¯¼å‡ºç”Ÿæˆçš„Redux actioncreatorså’Œæ•´ä¸ªSliceçš„reduceræ–¹æ³•ã€‚

Reduxéœ€è¦é€šè¿‡åˆ¶ä½œæ•°æ®å‰¯æœ¬å’Œæ›´æ–°å‰¯æœ¬æ¥ä¸å¯å˜åœ°æ›´æ–°Stateï¼Œç„¶è€ŒRedux Toolkitçš„createSliceå’ŒcreateReducer APIå†…éƒ¨ä½¿ç”¨äº†Immerï¼Œè¿™å…è®¸å¯ä»¥ç›´æ¥æ›´æ–°é€»è¾‘ï¼Œä¸å¿…åˆ¶ä½œå‰¯æœ¬ï¼Œå®ƒå°†è‡ªåŠ¨æˆä¸ºæ­£ç¡®çš„ä¸å¯å˜æ›´æ–°ã€‚

[![redux](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P610_30570.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P610_30570.jpg)

4. å°†Slice Reducer()æ·»åŠ è¿›Store

æ¥ä¸‹æ¥éœ€è¦å¼•å…¥Counter Sliceçš„`reducer()`æ–¹æ³•å¹¶æŠŠå®ƒæ·»åŠ åˆ°Storeä¸­ã€‚é€šè¿‡åœ¨reducer()æ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ªå±æ€§ï¼Œå‘Šè¯‰Storeä½¿ç”¨è¿™ä¸ªSlice Reducer()æ–¹æ³•å»å¤„ç†æ‰€æœ‰çš„stateæ›´æ–°ã€‚

[![reducer](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P610_30593.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P610_30593.jpg)

5. åœ¨Reactç»„ä»¶ä¸­ä½¿ç”¨Redux Stateå’ŒAction
   ç°åœ¨å¯ä»¥ä½¿ç”¨react-reduxé’©å­åœ¨Reactç»„ä»¶ä¸­æ“ä½œReduxStoreã€‚å¯ä»¥ä½¿ç”¨`useSelector`ä»Storeä¸­è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨`useDispatch`æ¥æ´¾å‘Actionã€‚

ä½¿ç”¨useSelector()å’ŒuseDispatch()Hookæ¥æ›¿ä»£connect()ã€‚

ä¼ ç»Ÿçš„Reactåº”ç”¨åœ¨ä¸Reduxè¿›è¡Œè¿æ¥æ—¶é€šè¿‡react-reduxåº“çš„connect()å‡½æ•°æ¥ä¼ å…¥mapState()å’ŒmapDispatch()å‡½æ•°ä»¥ä¾¿å°†Reduxä¸­çš„Stateå’ŒActionå­˜å‚¨åˆ°ç»„ä»¶çš„propsä¸­ã€‚

react-reduxæ–°ç‰ˆå·²ç»æ”¯æŒuseSelector()å’ŒuseDispatchHook()ï¼Œå¯ä»¥ä½¿ç”¨å®ƒä»¬æ›¿ä»£connect()çš„å†™æ³•ã€‚é€šè¿‡å®ƒä»¬å¯ä»¥åœ¨çº¯å‡½æ•°å¼ç»„ä»¶ä¸­è·å–Storeä¸­çš„å€¼å¹¶ç›‘æµ‹å˜åŒ–ã€‚

åˆ›å»ºä¸€ä¸ª`src/features/counter/Counter.js`æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­å¼€å‘Counterç»„ä»¶ï¼Œç„¶ååœ¨App.jsæ–‡ä»¶ä¸­å¼•å…¥è¿™ä¸ªç»„ä»¶ï¼Œå¹¶ä¸”åœ¨`<App>`é‡Œæ¸²æŸ“å®ƒã€‚

[![app.js](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P611_30610.jpg)](https://res.weread.qq.com/wrepub/CB_3300054198_Figure-P611_30610.jpg)

## å››ã€çŠ¶æ€ç®¡ç†ï¼ˆRecoilï¼‰
ä¸çœ‹äº†ï¼Œè¿™ä¸ªreactçš„ç”Ÿæ€æœªå…æœ‰ç‚¹å¤ª`ä¸°å¯Œ`äº†å§ï¼ŸğŸ˜µ

åœ¨React Europe 2020 Conferenceä¸Šï¼ŒFacebookå†…éƒ¨å¼€æºäº†ä¸€ç§çŠ¶æ€ç®¡ç†åº“Recoilã€‚Recoilæ˜¯Facebookæ¨å‡ºçš„ä¸€ä¸ªå…¨æ–°çš„ã€å®éªŒæ€§çš„JavaScriptçŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒè§£å†³äº†ä½¿ç”¨ç°æœ‰Context APIåœ¨æ„å»ºè¾ƒå¤§åº”ç”¨æ—¶æ‰€é¢ä¸´çš„å¾ˆå¤šé—®é¢˜ã€‚

è¿˜æ˜¯å¤§è‡´çœ‹äº†ä¸€ä¸‹ï¼Œemmmmâ€¦â€¦ æ„Ÿè§‰å’Œpiniaçš„åŸå­åŒ–æ€æƒ³ä¸€æ ·ï¼Œç„¶å2020æ‰å¼€æºï¼Œæ„Ÿè§‰ï¼Œå”‰ï¼Œå‰ç«¯çœŸçš„è¿­ä»£ä¹Ÿå¤ªå¿«äº†ï¼Œæ€»æ˜¯æœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯ä½ ç”¨reduxæ—¶ï¼Œéš¾é“æ²¡æœ‰æ„Ÿè§‰åˆ°å¾ˆéš¾ç”¨å—ï¼Œé¢ï¼Œå…«è‚¡æ–‡å†™å®Œäº†ï¼Œåˆæœ‰æ–°çš„æ¦‚å¿µå‡ºç°â€¦â€¦

çœ‹äº†è¿™ä¸ªreduxï¼Œæ‰çŸ¥é“piniaæœ‰å¤šé¦™å•Šï¼ï¼ï¼ï¼ï¼

## React Native
æ¯•è®¾ç”¨è¿™ä¸ªå†™çš„ç§»åŠ¨ç«¯ï¼Œå½“æ—¶ä¹Ÿæ²¡æœ‰æ·±å…¥äº†è§£ï¼Œæ„Ÿè§‰ä¸»è¦æ˜¯æ‰“åŒ…åˆ°åŸç”Ÿçš„é…ç½®æ¯”è¾ƒå¤æ‚ï¼Œæš‚æ—¶ä¸è®°å½•äº†ï¼Œç®€å•äº†è§£ä¸€ä¸‹å§â€¦â€¦